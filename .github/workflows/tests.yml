---

name: Tests

on:
  push:
    branches:
      - '*.*'
  pull_request:
    branches:
      - '*.*'

jobs:
  pospell:
    name: 'Orthographe'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install pospell
        run: |
          sudo apt-get update
          sudo apt-get install -y hunspell hunspell-fr-comprehensive
          sudo python3 -m pip install pospell
      - name: Run pospell
        run: pospell -p dict -l fr_FR *.po */*.po

  powrap:
    name: 'Ensure wrapping consistency'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install powrap
        run: |
          sudo apt-get update
          sudo apt-get install gettext
          sudo python3 -m pip install powrap
      - name: Run powrap
        run: powrap --check --quiet *.po */*.po

  padpo:
    name: 'Grammaire'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: '3.9'
      - name: Install padpo
        run:
          python3.9 -m venv .venv
          .venv/bin/python -m pip install --upgrade pip
          .venv/bin/python -m pip install padpo
      - name: Run padpo
        run: .venv/bin/padpo -i *.po */*.po 2>&1 | grep -v -Ff padpo.ignore

  sphinx:
    name: 'Build the doc'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/cache@v2
        with:
          path: '~/cpython/'
          key: '1'
      - name: Clone cpython
        run: |
          if [ ! -d ~/cpython ]; then
            git clone https://github.com/python/cpython ~/cpython/
          else
            git -C ~/cpython fetch
          fi
      - name: make
        run: make --trace CPYTHON_PATH=$HOME/cpython/
